<div class="card p-2">
    <h1 class="m-3" style="text-align: center;">ADMINISTRACIÓN DE USUARIOS</h1>
    <p-toast></p-toast>
    <p-table [value]="usuarios" editMode="row" selectionMode="single" [paginator]="true" [rows]="5" [showCurrentPageReport]="true"
    dataKey="Analista_ID"  styleClass="p-datatable-gridlines" [tableStyle]="{ 'min-width': '50rem'}">
        <ng-template pTemplate="header">
            <tr>
                <th style="width:10%">Usuario ID</th>
                <th style="width:20%">Nombre</th>
                <th style="width:15%">Nombre Login</th>
                <th style="width:20%">Tipo de cuenta</th>
                <th style="width:15%">Contraseña</th>
                <th style="width:20%"><button pButton pRipple label=" New" class="p-button-success mr-2" [style]="{'width':'100%'}" (click)="showDialogNewUser()"><i class="fa-solid fa-plus me-2"></i></button>
                </th>

            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-users let-editing="editing" let-ri="rowIndex">
            <tr [pEditableRow]="users">
                <td>
                    {{ users.Analista_ID }} 
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <input pInputText type="text" [(ngModel)]="users.Nombre">
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{ users.Nombre }}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <input pInputText type="text" [(ngModel)]="users.NombreUsuario">
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{ users.NombreUsuario }}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-dropdown [options]="Roles" appendTo="body" [(ngModel)]="rolUser" [style]="{'width':'100%'}"></p-dropdown>
                        </ng-template>
                        <ng-template pTemplate="output" [ngSwitch]="users.EsAdmin ">
                            <output *ngSwitchCase="0">Servicio-Residencia</output>
                            <output *ngSwitchCase="1">Admin</output>
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-password  [toggleMask]="true" [(ngModel)]="renewPassword"></p-password>
                        </ng-template>
                        <ng-template pTemplate="output">
                            ************
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <div class="d-flex align-items-center justify-content-center gap-2">
                        <button *ngIf="!editing" pButton pRipple pInitEditableRow icon="pi pi-pencil" class="p-button-rounded p-button-success me-2" (click)="onRowEditInit(users)"><i class="fa-solid fa-pen"></i></button>
                        <!-- <button *ngIf="!editing" pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-danger me-2" (click)="onRowEditDelete(users)"><i class="fa-solid fa-trash"></i></button>-->
                        <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="onRowEditSave(users)" class="p-button-rounded p-button-text p-button-success mr-2"><i class="fa-solid fa-check" style="color: #13d816;"></i></button>
                       <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" (click)="onRowEditCancel(users, ri)" class="p-button-rounded p-button-text p-button-danger"  ><i class="fa-solid fa-xmark" style="color: #d80e0e;"></i></button>

                       <div class="p-fluid p-1">
                        <p-selectButton *ngIf="!editing" [options]="stateOptions" [(ngModel)]="users.Activo" optionLabel="label" optionValue="value" (click)="onRowEditDelete(users)"></p-selectButton>
                    </div>
<!-- <p-inputSwitch  [(ngModel)]="users.Activo"  (click)="onRowEditDelete(users)"></p-inputSwitch>-->
                    </div>
                 </td>

            </tr>
        </ng-template>
    </p-table>


    <p-dialog [(visible)]="newUserDialog" [style]="{ width: '450px' }" header="Nuevo Usuario" [modal]="true" styleClass="p-fluid">
        <ng-template pTemplate="content">
      <div class="mt-3 p-2">

         <div class="field mb-3">
            <span class="p-float-label">
                <input type="text" pInputText id="name" [(ngModel)]="name" required autofocus />
                <label for="password">Nombre</label>
            </span>
        </div>
        <div class="field mb-3  mt-4">
            <label for="inventoryStatus">Tipo de Usuario</label>
            <p-dropdown [options]="Roles" appendTo="body" [(ngModel)]="rolUser" [style]="{'width':'100%'}"></p-dropdown>
        </div>
        <div class="field mb-3 mt-4">
            <span class="p-float-label">
                <input type="text" pInputText id="name" [(ngModel)]="nameUser" required autofocus />
                <label for="password">Nombre Usuario</label>
            </span>
     
   
        </div>
        <div class="field mb-3 mt-4">
            <span class="p-float-label">
                <p-password  [toggleMask]="true" [(ngModel)]="contrasena"></p-password>
                <label for="password">Contraseña</label>
            </span>
        </div>

      </div>
           
        </ng-template>
    
        <ng-template pTemplate="footer">

            <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"><i class="fa-solid fa-xmark me-2"></i></button>
            <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="registerUser()"><i class="fa-solid fa-check me-2"></i></button>
        
         </ng-template>
    </p-dialog>


</div>